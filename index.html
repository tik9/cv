<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="media/style_tk.css">
    <link rel="stylesheet" href="media/cookie.css">

    <link rel="icon" type="image/png" href="favicon.png" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="media/cookie.js"></script>
    <script src="media/date.js"></script>
    <script src="media/ip.js"></script>
    <script src="media/links.js"></script>
    <!--    <script src="media/serve.js"></script>-->
    <script>
    </script>
</head>

<body>
    <div class="jumbotron text-center">
        <span id=tk></span>
        <p>An IT Administrator</p>

    </div>

    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <h3>About </h3>
                <p>A german freelancer</p>
            </div>
            <div class="col-sm-4">
                <h3>Things to know</h3>
                <p>CEO of a life, CTO of localhost, co-founder of a son, a developer in Javascript</p>
            </div>
            <div class="col-sm-4">
                <h3>Hyper links</h3>
                <div id=linkstop></div>
            </div>
        </div>

        <div class="space"></div>

        <h4>Github Repos</h4>
        <div id=projects></div>

        <!-- <div id=linksblog></div> -->

        <div class=space>
            <h4>Recent posts</h4>
            <div id=so_api></div>
        </div>

        <h5> <a href='https://stackexchange.com/users/1886776/timo?tab=activity'>More posts</a></h5>

        <div class=space></div>

        <h4 class='space'>Contact</h4>
        <form action='https://formspree.io/user153015@gmail.com' method='post'>

            <div class="form-group">
                <label for="nam">Name</label>
                <input type="text" name=name class="form-control" id="name" placeholder="Enter your Name">
            </div>

            <div class="form-group">
                <label for="exampleInputEmail1">Email address</label>
                <input type="email" name=email class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp"
                    placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                    else.</small>
            </div>

            <div class="form-group">
                <label for="Textarea1">Message</label>
                <textarea name=message class="form-control" id="extarea1" rows="3" name=textarea
                    placeholder="Enter message"></textarea>
            </div>
            <input type="hidden" name="_subject" value='email von Kontaktformular'>
            <button type="submit" class="btn btn-primary">Submit</button>

        </form>

        <div style="padding-top: 100px;"></div>

        <iframe src="footer_en.html" height="200" width="500" title="footer"></iframe>
        <!-- <div id=footer></div> -->

        <div id="cookieConsent">
            <div id="closeCookieConsent">x</div>
            The website is using cookies. <a class="cookieConsentOK">That's Fine</a>
        </div>

    </div>
    <script>

        listrepos = document.createElement('ul')
        document.getElementById('projects').appendChild(listrepos)

        user = 'tik9'
        apirepo = `https://api.github.com/users/${user}`
        ghtk = `https://github.com/${user}`


        function printRepoCount() {
            responseObj = JSON.parse(this.responseText)
            console.log(responseObj.public_repos + " public repositories")
        }
        request = new XMLHttpRequest()
        request.onload = printRepoCount
        request.open('get', apirepo, true)
        request.send()

        $.getJSON(apirepo + '/repos', {}, function (data) {
            console.log('data', data)
            data.forEach(v => {
                console.log(v.url)
                listItemRepo = document.createElement('li')
                listrepos.appendChild(listItemRepo)
                hlink=document.createElement('a')
                listItemRepo.appendChild(hlink)
                hlink.textContent=v.name
                hlink.href=v.html_url

            })
        })


        function truncate(str) {
            if (str.length <= truncateCut) {
                return str
            }
            subString = str.substr(0, truncateCut)
            return subString.substr(0, subString.lastIndexOf(' ')) + '..'
        }

        // arr = ['comments', 'posts', 'questions', 'answers']
        copo = ['comments', 'posts']
        maxcount = 6
        truncateCut = 200

        copo.forEach(function (elem) {
            // console.log('elem', elem);

            se = 'https://api.stackexchange.com/2.2'
            user = se + '/users/1705829'
            so = 'site=stackoverflow'
            so = 'site=stackoverflow&filter=withbody'
            // so = 'order=desc&sort=activity&site=stackoverflow&filter=withbody'

            url = user + '/' + elem + '?' + so
            // console.log('url', url)

            listpost = document.createElement('ul')

            document.getElementById('so_api').appendChild(listpost)

            responseData = fetch(url).then(response => response.json())

            responseData.then(({
                items,
                has_more,
                quota_max,
                quota_remaining
            }) => {
                counter = 1
                for ({
                    creation_date,
                    score,
                    answer_count,
                    link,
                    body,
                    title
                }
                    of items) {
                    if (counter == maxcount) {
                        break
                    }
                    counter++

                    dateString = datef(creation_date)

                    // console.log('elem, link, title', elem, link, title);

                    listItemPost = document.createElement('li')
                    listpost.appendChild(listItemPost)
                    // bodyPost = body.substring(0, 200)
                    bodyPost = truncate(body)

                    bodyPost = bodyPost.replace(/<\/?[^>]+(>|$)/g, '')
                    // bodyPost = bodyPost.replace(/&quot;/g, '')
                    bodyPost = bodyPost.replace(/&#39;/g, '')

                    a = document.createElement('a')
                    listItemPost.appendChild(a)
                    if (link == undefined) {
                        a.href = 'https://stackexchange.com/users/1886776/timo?tab=activity'

                        a.textContent = `${dateString} | ${bodyPost}`

                    } else {
                        a.href = link
                        a.textContent = `${dateString} | ${bodyPost}`
                    }
                }
            })
        })

        linksblog = {
            'Answers on Pluralsight Skill Test': 'pluralsight-skill-test/#table-of-contents',
            'A Python app to get text from images and prepare them': 'tesseractToMarkdown'
        }

        listPosts = document.createElement('ol')
        document.getElementById('linksblog').appendChild(listPosts)
        for (key in linksblog) {
            listItemPost = document.createElement('li')
            listPosts.appendChild(listItemPost)
            a = document.createElement('a')
            listItemPost.appendChild(a)
            a.href = ghtk + linksblog[key]
            a.textContent = key
        }

    </script>
</body>

</html>