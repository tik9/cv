<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="media/style_tk.css">
    <link rel="stylesheet" href="media/cookie.css">

    <link rel="icon" type="image/png" href="favicon.png" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="media/cookie.js"></script>
    <script src="media/date.js"></script>
    <script src="media/ip.js"></script>
    <script src="media/links.js"></script>
    <!--    <script src="media/serve.js"></script>-->
    <script>
    </script>
</head>

<body>
    <div class="jumbotron text-center">
        <span id=tk></span>
        <p>An IT developer</p>

    </div>

    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <h3>About </h3>
                <p>A german IT freelancer</p>
            </div>
            <div class="col-sm-4">
                <h3>Things to know</h3>
                <p>
                    <span id=about></span>
                </p>
            </div>
            <div class="col-sm-4">
                <h3>Hyper links</h3>
                <div id=linkstop></div>
            </div>
        </div>

        <div class="space"></div>

        <h4><span id=repocount></span> Github Repositories</h4>
        <div id=github></div>

        <div class=space>
            <h4>Posts</h4>
            <div id=so_api></div>
        </div>

        <!-- <div class="space"></div> -->
        <h5> <a href='https://stackexchange.com/users/1886776/timo?tab=activity'>More posts</a></h5>
        <!-- <div class="space"></div> -->

        <!-- <h4>Downloads</h4> -->

        <!-- <div id=filesGh></div> -->

        <!-- <div class=space></div> -->

        <h4 class=space id=toContact >Contact</h4>
        <form action=https://formspree.io/user153015@gmail.com method=post>

            <div class=form-group>
                <label for="nam">Name</label>
                <input type="text" name=name class="form-control" id="name" placeholder="Enter your Name">
            </div>

            <div class=form-group>
                <label for=exampleInputEmail1>Email address</label>
                <input type=email name=email class=form-control id=exampleInputEmail1 aria-describedby=emailHelp
                    placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                    else.</small>
            </div>

            <div class=form-group>
                <label for="Textarea1">Message</label>
                <textarea name=message class="form-control" id="extarea1" rows="3" name=textarea
                    placeholder="Enter message"></textarea>
            </div>
            <input type=hidden name=_subject value='email von Kontaktformular'>
            <button type=submit class='btn btn-primary'>Submit</button>

        </form>

        <div style="padding-top: 100px;"></div>

        <a target=_blank href=footer_en.html>Imprint</a> | <a id='fromContact' href='#'>Contact</a>

        <div id="cookieConsent">
            <div id="closeCookieConsent">x</div>
            The website is using cookies. <a class="cookieConsentOK">That's Fine</a>
        </div>

    </div>
    <script>
        $("#fromContact").click(function () {
            $("html, body").animate({ scrollTop: $("#toContact").offset().top }, 500);
            return true;
        });
        listrepos = document.createElement('ul')
        document.getElementById('github').appendChild(listrepos)

        user = 'tik9'
        gh = 'https://api.github.com'
        repos = 'repos'
        ghApiUser = `${gh}/users/${user}`

        urlFilesGh = `${ghApiUser}/${repos}/${user}/cv/contents/output`
        // urlFilesGh = 'https://api.github.com/repos/tik9/cv/contents/output'


        function printRepoCount() {
            responseObj = JSON.parse(this.responseText)
            document.getElementById('repocount').textContent = responseObj.public_repos
        }
        request = new XMLHttpRequest()
        request.onload = printRepoCount
        request.open('get', ghApiUser, true)
        request.send()

        $.getJSON(`${ghApiUser}/${repos}`, function (data) {
            // console.log('data now', data)

            function compare(a, b) {
                if (a.watchers > b.watchers) {
                    return -1
                }
                if (a.watchers < b.watchers) {
                    return 1
                }
                return 0
            }

            data.sort(compare)
            data.forEach(v => {

                listItemRepo = document.createElement('li')
                listrepos.appendChild(listItemRepo)
                hlink = document.createElement('a')
                listItemRepo.appendChild(hlink)
                hlink.textContent = `${v.description} | Stars: ${v.watchers}`
                hlink.href = v.html_url
            })
        })


        function truncate(str) {
            if (str.length <= truncateCut) {
                return str
            }
            subString = str.substr(0, truncateCut)
            return subString.substr(0, subString.lastIndexOf(' ')) + '..'
        }

        // arr = ['comments', 'posts', 'questions', 'answers']
        copo = ['comments', 'posts']
        maxcount = 6
        truncateCut = 200

        copo.forEach(function (elem) {
            // console.log('elem', elem);

            se = 'https://api.stackexchange.com/2.2'
            user = se + '/users/1705829'
            so = 'site=stackoverflow'
            so = 'site=stackoverflow&filter=withbody'
            // so = 'order=desc&sort=activity&site=stackoverflow&filter=withbody'

            urlFilesGh = user + '/' + elem + '?' + so
            // console.log('urlFilesGh', urlFilesGh)
            // $.getJSON(urlFilesGh, function (data) {
            //     console.log('data now', data)
            // })

            listpost = document.createElement('ul')

            document.getElementById('so_api').appendChild(listpost)

            responseData = fetch(urlFilesGh).then(response => response.json())

            responseData.then(({
                items,
                has_more,
                quota_max,
                quota_remaining
            }) => {
                counter = 1
                for ({
                    creation_date,
                    score,
                    answer_count,
                    link,
                    body,
                    title
                }
                    of items) {
                    if (counter == maxcount) {
                        break
                    }
                    counter++

                    dateString = datef(creation_date)

                    listItemPost = document.createElement('li')
                    listpost.appendChild(listItemPost)
                    bodyPost = truncate(body)

                    bodyPost = bodyPost.replace(/<\/?[^>]+(>|$)/g, '')
                    bodyPost = bodyPost.replace(/&quot;/g, '')
                    bodyPost = bodyPost.replace(/&#39;/g, '')

                    a = document.createElement('a')
                    listItemPost.appendChild(a)
                    if (link == undefined) {
                        a.href = 'https://stackexchange.com/users/1886776/timo?tab=activity'

                    } else {
                        a.href = link
                    }
                    a.textContent = `${dateString} | ${bodyPost}`
                    // | ${score}
                }
            })
        })

    </script>
</body>

</html>