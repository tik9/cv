
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TK</title>
	
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
	  
  <!-- <script src="https://cdn.tiny.cloud/1/eh0ungvfukjyyzr0gpetf8v1wi1hoswfonuueub06klirvs3/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script> -->
  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>

<!--
<script src=js.js></script>
-->

<script>
//api tiny cloud
//eh0ungvfukjyyzr0gpetf8v1wi1hoswfonuueub06klirvs3
  tinymce.init({
        selector: 'textarea',
		 readonly : 1,
		  height : "280"
      })

</script>
<style>
.space {
  padding-top: 40px;
  padding-bottom: 30px
}
</style>
</head>
<body>

<div class="jumbotron text-center">
<!--
  <h1><span class=tem>{{ ich_name }}</span></h1>
-->
<!--
  <p><span class=tem>{{ job_sys }}</span></p>
-->

<h1><span class=tem>Timo KÃ¶rner</span></h1>
  <p><span class=tem>Administrator Windows</span></p>

</div>
  
<div class="container">
  <div class="row">
    <div class="col-sm-4">
      <h3>About</h3>
      <p>I am a Freelancer</p>
    </div>
    <div class="col-sm-4">
      <h3>Interests</h3>
      <p>Bash, Git and Javascript</p>
    </div>
    <div class="col-sm-4">
      <h3>Links</h3> 
<ul>	  
      <li><a href='https://github.com/tik9' >github</a></li>
<li><a href='https://stackoverflow.com/users/1705829/timo' >Stackoverflow</a></li>
<li><a href=output/cv_en.html>CV</a></li>
<li><a href=https://raw.githubusercontent.com/tik9/cv/master/README.md>Just a horse</a>
</ul>   
   </div>
  </div>

<h4>Blog</h4>  
  <h5>July 2020 </h6>
<h6 class=space>Copy folders and files from one server to another with <code>Robocopy</code> and <code>Powershell</code></h5>

<code>kopie.cmd</code>:

<textarea class="code">
<pre>
<code class=html>
SET vQuelle="\\sv-n2v\cifs_data$\data"
SET vZiel="D:\DATA\"
SET vLogfile="D:\ADMIN\log\Logfile-%DATE%.txt"
SET vKopierparameter=/E /MIR /COPY:DATSO /R:0 /W:0 /NP /NFL /LOG:%vLogFile% /mt:16

ROBOCOPY %vQuelle% %vZiel% %vKopierparameter% 

</code>
</pre>
</textarea>

<div class=space>The next steps:</div>
<ol>
<li>Close the source, which means delete all <code>NTFS</code> user rights except admin</li>
<li>Prepare the Backup of the destination and stop backuping the source</li>
<li>Make links to the (new) destination share via group policies or dfs</li>
</ol>


<div class=space>Use <a href=https://github.com/raandree/NTFSSecurity>NTFSAccess Plugin </a> for Powershell to remove unwanted groups like <code>administrators</code>:</div>

<textarea>
<pre>
<code class=powershell>
$alle_objekte = Get-ChildItem2 $alle_objekte -Recurse -Directory
foreach ($Ordner in $alle_objekte) {
    $hash = @{
        'Ordner' = $Ordner.FullName
    }
    $Rechte_objekt = $Ordner.GetAccessControl().access
     if ($Rechte_objekt.isinherited -contains $false) {
        $Rechte_objekt = $Rechte_objekt.Where( { $_.isinherited -eq $false })

        foreach ($acl in $Rechte_objekt) {
            $gruppe = $acl.IdentityReference
            if ($blacklist -contains $gruppe) {

                $hash.Gruppe = $gruppe
                $Report.Add([pscustomobject]$hash) | Out-Null
                
                Get-NTFSAccess -Path $Ordner.FullName -Account $gruppe
                #  | Remove-NTFSAccess -PassThru
            }
        }   
     }
}
</code>
</pre>
</textarea>

</body>
</html>
